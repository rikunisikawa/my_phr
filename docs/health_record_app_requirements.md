# パーソナル健康記録アプリ 要件定義書

## 1. 概要
- **目的**: 利用者が自身の健康状態を記録・振り返りできるようにする。
- **対象ユーザー**: 健康管理を自己記録したい一般ユーザー。
- **プラットフォーム想定**: Web アプリケーション（PC/スマートフォンブラウザ対応）。

## 2. ステークホルダー
- エンドユーザー: 健康状態を記録・参照する。
- 開発チーム: アプリケーションの設計・実装・保守を担当。
- 運用管理者: データ保全、バックアップ、利用状況の監視を担当。

## 3. 用語定義
- **基本情報**: ユーザーのプロフィール情報（年齢・身長・体重・カスタム項目など）。
- **健康ログ**: 日々の状態や活動に関する記録。
- **カスタム項目**: ユーザーが任意に追加できる項目。各カテゴリで自由入力フィールドを想定。
- **サマリー**: 日次/週次/月次単位で集計・可視化された情報。

## 4. 前提・制約
- 認証基盤は既存のユーザー管理機能を利用する（本要件には含まない）。
- 多言語対応は日本語のみを対象とする。
- データはユーザーごとに分離し、他ユーザーへは共有されない。
- ブラウザ上での利用を想定し、レスポンシブデザインを採用する。

## 5. 機能要件
### 5.1 基本情報管理
- [FR-1] ユーザーは自身の年齢・身長・体重を入力・保存できる。
- [FR-2] ユーザーは基本情報に任意項目を追加・編集・削除できる。
- [FR-3] 基本情報はユーザープロフィール画面で確認できる。

### 5.2 健康状態記録
- [FR-4] ユーザーは日付ごとに健康状態（気分、ストレス、疲労感など）を入力・保存できる。
- [FR-5] ユーザーは運動内容（ウォーキング、ランニング、筋トレなど）を入力・保存できる。
- [FR-6] ユーザーは健康状態・運動内容に任意のカスタム項目を追加できる。
- [FR-7] 記録は時系列で閲覧でき、編集・削除が可能。

### 5.3 サマリー表示
- [FR-8] 日次サマリー: 当日の基本情報サマリーと健康ログを集約して表示する。
- [FR-9] 週次サマリー: 過去 7 日間の主要指標（例: スコア平均、運動時間合計）を表示する。
- [FR-10] 月次サマリー: 過去 1 ヶ月の主要指標を表示する。
- [FR-11] サマリー画面では折れ線グラフ・棒グラフなどで視覚化を提供する。

### 5.4 カスタム項目管理
- [FR-12] 各カテゴリ（基本情報 / 健康状態 / 運動内容）にユーザー固有のフィールドを定義できる。
- [FR-13] カスタム項目はデータ型（テキスト、数値、選択式）を選べる。
- [FR-14] カスタム項目はサマリー集計の対象に含められる。

## 6. 非機能要件
- [NFR-1] データ保存は 1 件の操作当たり 2 秒以内で完了する。
- [NFR-2] UI はモバイル画面幅 375px 以上で崩れない。
- [NFR-3] 日次/週次/月次のサマリー生成は 3 秒以内で応答。
- [NFR-4] 主要ブラウザ（Chrome/Edge/Safari）の最新バージョンで動作確認を行う。
- [NFR-5] ユーザーデータは HTTPS 経由で送受信する。

## 7. データ要件
### 7.1 データモデル（概略）
- **User**: 既存の認証システムを利用（ID, name, email）。
- **Profile**: user_id, age, height, weight, custom_fields(json)。
- **HealthLog**: id, user_id, date, mood, stress_level, fatigue_level, notes, custom_fields(json)。
- **ActivityLog**: id, health_log_id, activity_type, duration, intensity, custom_fields(json)。
- **SummaryCache** (任意): user_id, period_type(日/週/月), period_start, metrics(json), generated_at。

### 7.2 バリデーション
- 年齢・身長・体重は数値入力。上限/下限を定義（例: 年齢 0-120, 身長 50-250cm, 体重 10-300kg）。
- 気分・ストレス・疲労感は 1-5 スケールで記録。
- カスタム項目は名称必須、最大 30 文字。

## 8. 画面要件
1. **ダッシュボード画面**
   - 最新の日次サマリーを表示。
   - 最近 7 日の状態グラフ。
2. **基本情報編集画面**
   - プロフィール項目の一覧と編集フォーム。
   - カスタム項目の追加・並び替え。
3. **健康ログ入力画面**
   - 日付選択、状態入力フォーム、運動内容入力フォーム。
   - カスタム項目を含む入力コンポーネント。
4. **サマリー画面**
   - 日次/週次/月次をタブ切り替え表示。
   - グラフと主要統計指標。

## 9. API 要件（例）
- `GET /profile`、`PUT /profile`
- `GET /health_logs?from=&to=`、`POST /health_logs`、`PUT /health_logs/:id`、`DELETE /health_logs/:id`
- `GET /summaries?period=daily|weekly|monthly`
- `GET/POST/DELETE /custom_fields`

## 10. サマリー集計ロジック（高レベル）
- 日次: 当日の健康ログをまとめ、気分などのスコア平均、運動時間合計を計算。
- 週次: 対象週の日次集計を平均または合計し、週間トレンドを作成。
- 月次: 対象月の週次もしくは日次データを集約。主要指標（平均気分、総運動時間など）を算出。
- カスタム項目は数値型の場合のみ集計対象に含め、その他はタグやメモとして扱う。

## 11. テスト方針
- ユニットテスト: モデルバリデーション、集計ロジック。
- システムテスト: 主要画面の入出力フロー。
- UI テスト: レスポンシブ表示確認。

## 12. 移行/運用
- 初回リリース時は既存データなし。
- バックアップ: 1 日 1 回の自動バックアップ。
- ログ: 主要操作ログを保管し 90 日保持。

## 13. 今後の拡張（案）
- ウェアラブルデバイス連携。
- リマインダー通知機能（メール/プッシュ）。
- メディカルアドバイスのレコメンド表示。
